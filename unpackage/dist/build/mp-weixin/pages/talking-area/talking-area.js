"use strict";const t=require("../../common/vendor.js"),e=require("../../config.js"),o={data:()=>({postList:"",isShow:"",isCommentViewShow:"",content:"",comment:"",currentPostId:""}),methods:{clickPost(o){const s=this.postList[o].id;t.index.request({url:e.config.url+"/question/click",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{questionId:s},success:t=>{console.log(t),this.postList[o].click++}})},likePost(o){const s=this.postList[o].id;t.index.request({url:e.config.url+"/question/approve",header:{"content-type":"application/x-www-form-urlencoded"},method:"POST",data:{questionId:s},success:t=>{console.log(t),this.postList[o].likes++}})},deletePost(o){const s=this.postList[o].id;t.index.showModal({title:"提示",cancelText:"取消",confirmText:"确认",showCancel:!0,success:i=>{i.confirm&&t.index.request({url:e.config.url+"/question/deleteQuestion?questionId="+s,method:"DELETE",success:e=>{console.log(e),t.index.showToast({title:"删除成功",icon:"success"}),this.postList.splice(o,1)}})}})},likeComment(o,s){const i=this.postList[o].comment[s].id;t.index.request({url:e.config.url+"/comment/approve",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{commentId:i},success:t=>{console.log(t),this.postList[o].comment[s].likes++}})},deleteComment(o,s){const i=this.postList[o].comment[s].id;t.index.showModal({title:"提示",cancelText:"取消",confirmText:"确认",showCancel:!0,success:n=>{n.confirm&&t.index.request({url:e.config.url+"/comment/delete?commentId="+i,method:"DELETE",success:e=>{t.index.showToast({title:"删除成功",icon:"success"}),this.postList[o].comment.splice(s,1)}})}})},showComment(o){console.log(e.config.url),this.postList[o].id,"查看评论"==this.postList[o].btnName?(t.index.request({url:e.config.url+"/comment/list?questionId=1632352104556711937&page=1&pageSize=10",method:"GET",success:t=>{console.log(t),this.postList[o].comment=t.data.data.records,this.postList[o].btnName="收起评论"}}),t.index.request({url:e.config.url+"/comment/total?questionId=1632352104556711937",method:"GET",success:t=>{console.log(t);let e=t.data.data;this.postList[o].totalComment=e}})):"收起评论"==this.postList[o].btnName&&(this.postList[o].btnName="查看评论")},submitPost(){t.index.request({url:e.config.url+"/question/postQuestion",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{content:this.content,userId:"",username:""},success:e=>{console.log(e),1==e.data.code&&(t.index.showToast({title:"发布成功",icon:"success"}),this.isShow=!1,this.content="",this.created())}})},submitComment(){t.index.request({url:e.config.url+"/comment/postComment",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:{content:this.comment,userId:"",questionId:this.currentPostId},success:t=>{console.log(t),1==t.data.code&&(this.isCommentViewShow=!1,this.comment="")}})}},onPullDownRefresh(){t.index.startPullDownRefresh({success:()=>{}})},created(){this.isShow=!1,t.index.request({url:"http://8.130.109.84:8080/question/list?page=1&pageSize=10",method:"GET",success:t=>{console.log(t),this.postList=t.data.data.records,console.log(this.postList),this.postList.forEach(((t,e)=>{console.log(t),t.btnName="查看评论",t.likeStatus="../../static/like.png"}))}})}};const s=t._export_sfc(o,[["render",function(e,o,s,i,n,c){return t.e({a:t.f(n.postList,((e,o,s)=>t.e({a:t.t(e.userName),b:t.t(e.click),c:t.o((t=>c.deletePost(o))),d:t.t(e.time),e:t.t(e.content),f:e.likeStatus,g:0!=e.likes},0!=e.likes?{h:t.t(e.likes)}:{},{i:t.o((t=>c.likePost(o))),j:t.o((t=>{n.isCommentViewShow=!n.isCommentViewShow,this.currentPostId=o})),k:t.o((t=>c.clickPost(o))),l:t.t(e.btnName),m:"收起评论"==e.btnName},"收起评论"==e.btnName?{n:t.t(e.totalComment)}:{},{o:t.o((t=>c.showComment(o))),p:"收起评论"==e.btnName},"收起评论"==e.btnName?{q:t.f(e.comment,((e,s,i)=>t.e({a:t.t(e.time),b:t.t(e.content),c:0!=e.likes},0!=e.likes?{d:t.t(e.likes)}:{},{e:t.o((t=>c.likeComment(o,s))),f:t.o((t=>c.deleteComment(o,s)))})))}:{}))),b:t.o((t=>this.isShow=!0)),c:n.isShow},n.isShow?{d:t.o((t=>this.isShow=!1)),e:n.content,f:t.o((t=>n.content=t.detail.value)),g:t.o(((...t)=>c.submitPost&&c.submitPost(...t)))}:{},{h:n.isCommentViewShow},n.isCommentViewShow?{i:n.comment,j:t.o((t=>n.comment=t.detail.value)),k:t.o(((...t)=>c.submitComment&&c.submitComment(...t))),l:t.o((()=>{}))}:{},{m:t.o((t=>n.isCommentViewShow=!1))})}]]);wx.createPage(s);
